
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z43R9PWW0B"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Z43R9PWW0B');
    </script>
    
    <title>Advanced Examples &#8212; elote 1.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=30d13653" />
    <link rel="stylesheet" type="text/css" href="_static/css/wabi.css?v=501c8ac3" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=71d92741" />
    <script src="_static/documentation_options.js?v=fc837d61"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Product Ranking with Elote" href="use_cases/product_ranking.html" />
    <link rel="prev" title="Examples" href="examples.html" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;0,9..144,700;1,9..144,400&family=Newsreader:ital,opsz,wght@0,6..72,400;0,6..72,500;1,6..72,400;1,6..72,500&family=Instrument+Sans:wght@400;500;600&family=IBM+Plex+Mono:wght@400&display=swap" rel="stylesheet">



<meta name="description" content="Advanced Examples - elote documentation">





<meta property="og:title" content="Advanced Examples">
<meta property="og:description" content="Advanced Examples - elote documentation">
<meta property="og:type" content="website">

<meta property="og:url" content="https://elote.mcginniscommawill.com/advance_example.html">


<meta property="og:site_name" content="elote">


<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Advanced Examples">
<meta name="twitter:description" content="Advanced Examples - elote documentation">

<meta name="twitter:site" content="@willmcginniser">





<link rel="canonical" href="https://elote.mcginniscommawill.com/advance_example.html">


 

  </head><body>
<header class="header">
  <div class="header__inner">
    
    <a href="https://mcginniscommawill.com" class="header__logo">
      McGinnis, Will
    </a>

    
    <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
      </svg>
    </button>

    
    <nav class="nav" role="navigation">
      
      
        
          
          
          
          <a href="https://mcginniscommawill.com/guides/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            Guides
          </a>
        
          
          
          
          <a href="https://mcginniscommawill.com/topics/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            Topics
          </a>
        
          
          
          
          <a href="https://mcginniscommawill.com/posts/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            Blog
          </a>
        
          
          
          
          <a href="https://mcginniscommawill.com/about/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            About
          </a>
        
          
          
          
          <a href="https://mcginniscommawill.com/coffee/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            Free Coffee
          </a>
        
          
          
          
          <a href="https://mcginniscommawill.com/oss/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            OSS
          </a>
        
      

      
      
      <a href="index.html" class="nav__link nav__link--active">
        Docs
      </a>
      
    </nav>
  </div>
</header>


<nav class="breadcrumbs" aria-label="Breadcrumb">
  <div class="breadcrumbs__inner">
    
    <a href="https://mcginniscommawill.com">Home</a>
    <span class="breadcrumbs__separator">/</span>
    
    <a href="index.html">Docs</a>
    
    
    <span class="breadcrumbs__separator">/</span>
    <span>Advanced Examples</span>
    
  </div>
</nav>

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="advanced-examples">
<h1>Advanced Examples<a class="headerlink" href="#advanced-examples" title="Link to this heading">¶</a></h1>
<section id="college-football-ranking">
<h2>College Football Ranking<a class="headerlink" href="#college-football-ranking" title="Link to this heading">¶</a></h2>
<p>In this example we are going to use a <code class="docutils literal notranslate"><span class="pre">LambdaArena</span></code> and the <code class="docutils literal notranslate"><span class="pre">CFPScrapy</span></code> library to build a rating system for college
football and see how it performs.</p>
<p>To start with we need historical data on games to seed our ratings with. Luckily there is a nice library/API for that:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">CFBScrapy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cfb</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">elote</span><span class="w"> </span><span class="kn">import</span> <span class="n">LambdaArena</span>


<span class="c1"># pull API data</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">cfb</span><span class="o">.</span><span class="n">get_game_info</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">):</span>
    <span class="n">train_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfb</span><span class="o">.</span><span class="n">get_game_info</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2000</span> <span class="o">+</span> <span class="n">year</span><span class="p">))</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">cfb</span><span class="o">.</span><span class="n">get_game_info</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2018</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfb</span><span class="o">.</span><span class="n">get_game_info</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2019</span><span class="p">))</span>

<span class="c1"># sort the dates and drop unneeded cols</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="s1">&#39;home_team&#39;</span><span class="p">,</span> <span class="s1">&#39;away_team&#39;</span><span class="p">,</span> <span class="s1">&#39;home_points&#39;</span><span class="p">,</span> <span class="s1">&#39;away_points&#39;</span><span class="p">])</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="s1">&#39;home_team&#39;</span><span class="p">,</span> <span class="s1">&#39;away_team&#39;</span><span class="p">,</span> <span class="s1">&#39;home_points&#39;</span><span class="p">,</span> <span class="s1">&#39;away_points&#39;</span><span class="p">])</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;start_date&#39;</span><span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;start_date&#39;</span><span class="p">)</span>


<span class="c1"># then form matchup objects (winner first). First sort the data so the matchups happen in true date order</span>
<span class="n">train_matchups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">train_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">train_matchups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
        <span class="n">row</span><span class="o">.</span><span class="n">home_team</span><span class="p">,</span>
        <span class="n">row</span><span class="o">.</span><span class="n">away_team</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;home_points&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">home_points</span><span class="p">,</span> <span class="s2">&quot;away_points&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">away_points</span><span class="p">}</span>
    <span class="p">))</span>

<span class="n">test_matchups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">test_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">test_matchups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
        <span class="n">row</span><span class="o">.</span><span class="n">home_team</span><span class="p">,</span>
        <span class="n">row</span><span class="o">.</span><span class="n">away_team</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;home_points&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">home_points</span><span class="p">,</span> <span class="s2">&quot;away_points&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">away_points</span><span class="p">}</span>
    <span class="p">))</span>
</pre></div>
</div>
<p>Next we need to make a lamba to execute the matchups with. Since we have the scores available in the attributes of our
matchup dataset, we can simply check the score to see if the first competitor won or lost:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>   <span class="c1"># we already know the winner, so the lambda here is trivial</span>
   <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
       <span class="k">if</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;home_points&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;away_points&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">):</span>
           <span class="k">return</span> <span class="kc">True</span>
       <span class="k">else</span><span class="p">:</span>
           <span class="k">return</span> <span class="kc">False</span>

<span class="n">To</span> <span class="n">start</span> <span class="k">with</span> <span class="n">we</span> <span class="n">will</span> <span class="n">use</span> <span class="n">an</span> <span class="n">Elo</span> <span class="n">competitor</span> <span class="k">with</span> <span class="n">a</span> <span class="err">``</span><span class="n">_k_factor</span><span class="err">``</span> <span class="n">of</span> <span class="mf">400.</span> <span class="n">We</span> <span class="n">will</span> <span class="n">train</span> <span class="n">the</span> <span class="n">ratings</span> <span class="k">with</span> <span class="n">a</span> <span class="n">tournament</span>
<span class="n">on</span> <span class="n">the</span> <span class="n">first</span> <span class="n">couple</span> <span class="n">of</span> <span class="n">decades</span> <span class="n">of</span> <span class="n">data</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># we use the default EloCompetitor, but adjust the k_factor to 400 before running the tournament</span>
<span class="n">arena</span> <span class="o">=</span> <span class="n">LambdaArena</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">arena</span><span class="o">.</span><span class="n">set_competitor_class_var</span><span class="p">(</span><span class="s1">&#39;_k_factor&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">arena</span><span class="o">.</span><span class="n">tournament</span><span class="p">(</span><span class="n">train_matchups</span><span class="p">)</span>
</pre></div>
</div>
<p>Once we’ve developed some ratings, let’s take a look at the training set and how the ratings performed, and use that
to select some potential thresholds:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># do a threshold search and clear the history for validation</span>
<span class="n">_</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">arena</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">random_search</span><span class="p">(</span><span class="n">trials</span><span class="o">=</span><span class="mi">10_000</span><span class="p">)</span>
<span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">do_nothing</span> <span class="o">=</span> <span class="n">arena</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="o">*</span><span class="n">thresholds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Train Set: thresholds=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">thresholds</span><span class="p">),</span> <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wins: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">,</span> <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;losses: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">,</span> <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do_nothing: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">do_nothing</span><span class="p">,</span> <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;win pct: </span><span class="si">%s%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="p">((</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span> <span class="o">+</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span> <span class="o">+</span> <span class="n">do_nothing</span><span class="p">))))</span>
<span class="n">arena</span><span class="o">.</span><span class="n">clear_history</span><span class="p">()</span>
</pre></div>
</div>
<p>This will return:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Train</span> <span class="n">Set</span><span class="p">:</span> <span class="n">thresholds</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6350196774347375</span><span class="p">,</span> <span class="mf">0.9364243175248251</span><span class="p">]</span>
<span class="n">wins</span><span class="p">:</span> <span class="mi">267</span>
<span class="n">losses</span><span class="p">:</span> <span class="mi">236</span>
<span class="n">do_nothing</span><span class="p">:</span> <span class="mi">171</span>
<span class="n">win</span> <span class="n">pct</span><span class="p">:</span> <span class="mf">39.61424332344214</span><span class="o">%</span>
</pre></div>
</div>
<p>And while we are here let’s also print out what the rankings would have been to start the 2018 season:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>   <span class="c1"># then we print out the top 25 as of the end of our training dataset</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Top 25 as of start of validation:&#39;</span><span class="p">)</span>
   <span class="n">rankings</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">arena</span><span class="o">.</span><span class="n">leaderboard</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">))[:</span><span class="mi">25</span><span class="p">]</span>
   <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rankings</span><span class="p">):</span>
       <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%d</span><span class="s1">) </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;competitor&#39;</span><span class="p">)))</span>

<span class="n">Which</span> <span class="n">will</span> <span class="nb">print</span><span class="p">:</span>

<span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span>

   <span class="n">Top</span> <span class="mi">25</span> <span class="k">as</span> <span class="n">of</span> <span class="n">start</span> <span class="n">of</span> <span class="n">validation</span><span class="p">:</span>
   <span class="mi">1</span><span class="p">)</span> <span class="n">Miami</span>
   <span class="mi">2</span><span class="p">)</span> <span class="n">Oklahoma</span>
   <span class="mi">3</span><span class="p">)</span> <span class="n">Florida</span> <span class="n">State</span>
   <span class="mi">4</span><span class="p">)</span> <span class="n">Oregon</span> <span class="n">State</span>
   <span class="mi">5</span><span class="p">)</span> <span class="n">Texas</span>
   <span class="mi">6</span><span class="p">)</span> <span class="n">Georgia</span> <span class="n">Tech</span>
   <span class="mi">7</span><span class="p">)</span> <span class="n">Washington</span>
   <span class="mi">8</span><span class="p">)</span> <span class="n">Virginia</span> <span class="n">Tech</span>
   <span class="mi">9</span><span class="p">)</span> <span class="n">Kansas</span> <span class="n">State</span>
   <span class="mi">10</span><span class="p">)</span> <span class="n">Notre</span> <span class="n">Dame</span>
   <span class="mi">11</span><span class="p">)</span> <span class="n">Cincinnati</span>
   <span class="mi">12</span><span class="p">)</span> <span class="n">TCU</span>
   <span class="mi">13</span><span class="p">)</span> <span class="n">Michigan</span>
   <span class="mi">14</span><span class="p">)</span> <span class="n">Arkansas</span>
   <span class="mi">15</span><span class="p">)</span> <span class="n">Toledo</span>
   <span class="mi">16</span><span class="p">)</span> <span class="n">Air</span> <span class="n">Force</span>
   <span class="mi">17</span><span class="p">)</span> <span class="n">Tennessee</span>
   <span class="mi">18</span><span class="p">)</span> <span class="n">Auburn</span>
   <span class="mi">19</span><span class="p">)</span> <span class="n">Florida</span>
   <span class="mi">20</span><span class="p">)</span> <span class="n">Boise</span> <span class="n">State</span>
   <span class="mi">21</span><span class="p">)</span> <span class="n">Louisville</span>
   <span class="mi">22</span><span class="p">)</span> <span class="n">Middle</span> <span class="n">Tennessee</span>
   <span class="mi">23</span><span class="p">)</span> <span class="n">North</span> <span class="n">Carolina</span>
   <span class="mi">24</span><span class="p">)</span> <span class="n">Pittsburgh</span>
   <span class="mi">25</span><span class="p">)</span> <span class="n">Oregon</span>
</pre></div>
</div>
<p>Now let’s take a look at some hold out validation by using these ratings to take a look at the 2018 and 2019 seasons. The
ratings will of course still update as the games are evaluated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># now validation</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Starting Validation Step...&#39;</span><span class="p">)</span>
<span class="n">arena</span><span class="o">.</span><span class="n">tournament</span><span class="p">(</span><span class="n">test_matchups</span><span class="p">)</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">arena</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">report_results</span><span class="p">()</span>
</pre></div>
</div>
<p>We can then look at the results from just this set (notice we ran <code class="docutils literal notranslate"><span class="pre">clear_history()</span></code> up above to wipe out the train set
results from our history tracker:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">do_nothing</span> <span class="o">=</span> <span class="n">arena</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Test Set: using 0.4/0.6 thresholds&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wins: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">,</span> <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;losses: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">,</span> <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do_nothing: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">do_nothing</span><span class="p">,</span> <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;win pct: </span><span class="si">%s%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="p">((</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span> <span class="o">+</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span> <span class="o">+</span> <span class="n">do_nothing</span><span class="p">))))</span>

<span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">do_nothing</span> <span class="o">=</span> <span class="n">arena</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="o">*</span><span class="n">thresholds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Test Set: using learned thresholds: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">thresholds</span><span class="p">),</span> <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wins: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">,</span> <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;losses: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">,</span> <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do_nothing: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">do_nothing</span><span class="p">,</span> <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;win pct: </span><span class="si">%s%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="p">((</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span> <span class="o">+</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span> <span class="o">+</span> <span class="n">do_nothing</span><span class="p">))))</span>
</pre></div>
</div>
<p>Which will print out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Test</span> <span class="n">Set</span><span class="p">:</span> <span class="n">using</span> <span class="mf">0.4</span><span class="o">/</span><span class="mf">0.6</span> <span class="n">thresholds</span>
<span class="n">wins</span><span class="p">:</span> <span class="mi">1045</span>
<span class="n">losses</span><span class="p">:</span> <span class="mi">456</span>
<span class="n">do_nothing</span><span class="p">:</span> <span class="mi">193</span>
<span class="n">win</span> <span class="n">pct</span><span class="p">:</span> <span class="mf">61.68831168831169</span><span class="o">%</span>

<span class="n">Test</span> <span class="n">Set</span><span class="p">:</span> <span class="n">using</span> <span class="n">learned</span> <span class="n">thresholds</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6350196774347375</span><span class="p">,</span> <span class="mf">0.9364243175248251</span><span class="p">]</span>
<span class="n">wins</span><span class="p">:</span> <span class="mi">804</span>
<span class="n">losses</span><span class="p">:</span> <span class="mi">483</span>
<span class="n">do_nothing</span><span class="p">:</span> <span class="mi">407</span>
<span class="n">win</span> <span class="n">pct</span><span class="p">:</span> <span class="mf">47.4616292798111</span><span class="o">%</span>
</pre></div>
</div>
<p>Not awesome. This is probably related to <code class="docutils literal notranslate"><span class="pre">k_factor</span></code> which tunes how quickly ratings will respond to new matchups. Let’s
try doubling it to 800 and rerunning. Now you will see the final output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Test</span> <span class="n">Set</span><span class="p">:</span> <span class="n">using</span> <span class="mf">0.4</span><span class="o">/</span><span class="mf">0.6</span> <span class="n">thresholds</span>
<span class="n">wins</span><span class="p">:</span> <span class="mi">1095</span>
<span class="n">losses</span><span class="p">:</span> <span class="mi">503</span>
<span class="n">do_nothing</span><span class="p">:</span> <span class="mi">96</span>
<span class="n">win</span> <span class="n">pct</span><span class="p">:</span> <span class="mf">64.63990554899645</span><span class="o">%</span>


<span class="n">Test</span> <span class="n">Set</span><span class="p">:</span> <span class="n">using</span> <span class="n">learned</span> <span class="n">thresholds</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5277889558418678</span><span class="p">,</span> <span class="mf">0.6981558136040092</span><span class="p">]</span>
<span class="n">wins</span><span class="p">:</span> <span class="mi">1093</span>
<span class="n">losses</span><span class="p">:</span> <span class="mi">526</span>
<span class="n">do_nothing</span><span class="p">:</span> <span class="mi">75</span>
<span class="n">win</span> <span class="n">pct</span><span class="p">:</span> <span class="mf">64.52184179456907</span><span class="o">%</span>
</pre></div>
</div>
<p>Before we get too excited about this, let’s take a look at the post-game win probabilities provided by the same API we
are getting data from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Test</span> <span class="n">Set</span><span class="p">:</span> <span class="n">using</span> <span class="n">probabilities</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dataset</span> <span class="k">as</span> <span class="n">baseline</span>
<span class="n">wins</span><span class="p">:</span> <span class="mi">1481</span>
<span class="n">losses</span><span class="p">:</span> <span class="mi">117</span>
<span class="n">do_nothing</span><span class="p">:</span> <span class="mi">96</span>
<span class="n">win</span> <span class="n">pct</span><span class="p">:</span> <span class="mf">87.42621015348288</span><span class="o">%</span>
</pre></div>
</div>
<p>So we’re not exactly going to Vegas.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="competitors.html">Competitors</a></li>
<li class="toctree-l1"><a class="reference internal" href="arenas.html">Arenas</a></li>
<li class="toctree-l1"><a class="reference internal" href="serialization.html">Serialization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Rating Systems</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rating_systems/elo.html">Elo Rating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="rating_systems/glicko.html">Glicko Rating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="rating_systems/ecf.html">ECF Rating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="rating_systems/dwz.html">DWZ Rating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="rating_systems/ensemble.html">Ensemble Rating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="rating_systems/comparison.html">Comparing Rating Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_cases/product_ranking.html">Product Ranking with Elote</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_cases/matchmaking.html">Matchmaking with Elote</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_cases/feature_prioritization.html">Feature Prioritization with Elote</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/competitors.html">Competitors API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/arenas.html">Arenas API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="blog_posts.html">Blog Posts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to Elote</a></li>
</ul>

<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <div class="footer__inner">
    
    
    <div class="footer__links">
      
        <a href="https://github.com/wdm0006" class="footer__link" target="_blank" rel="noopener noreferrer">
          GitHub
        </a>
      
        <a href="https://www.linkedin.com/in/wmcginnis/" class="footer__link" target="_blank" rel="noopener noreferrer">
          LinkedIn
        </a>
      
        <a href="https://x.com/willmcginniser" class="footer__link" target="_blank" rel="noopener noreferrer">
          Twitter
        </a>
      
    </div>
    

    
    <p class="footer__copy">
      
        &copy; 2020, Will McGinnis
      
    </p>
  </div>
</footer>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.querySelector('.nav-toggle');
    const nav = document.querySelector('.nav');
    if (toggle && nav) {
      toggle.addEventListener('click', function() {
        nav.classList.toggle('is-open');
        const isOpen = nav.classList.contains('is-open');
        toggle.setAttribute('aria-expanded', isOpen);
      });
    }
  });
</script>

  </body>
</html>