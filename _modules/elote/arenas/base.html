
<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z43R9PWW0B"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Z43R9PWW0B');
    </script>
    
    <title>elote.arenas.base &#8212; elote 1.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=30d13653" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/wabi.css?v=501c8ac3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=71d92741" />
    <script src="../../../_static/documentation_options.js?v=fc837d61"></script>
    <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;0,9..144,700;1,9..144,400&family=Newsreader:ital,opsz,wght@0,6..72,400;0,6..72,500;1,6..72,400;1,6..72,500&family=Instrument+Sans:wght@400;500;600&family=IBM+Plex+Mono:wght@400&display=swap" rel="stylesheet">



<meta name="description" content="elote.arenas.base - elote documentation">





<meta property="og:title" content="elote.arenas.base">
<meta property="og:description" content="elote.arenas.base - elote documentation">
<meta property="og:type" content="website">

<meta property="og:url" content="https://elote.mcginniscommawill.com/_modules/elote/arenas/base.html">


<meta property="og:site_name" content="elote">


<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="elote.arenas.base">
<meta name="twitter:description" content="elote.arenas.base - elote documentation">

<meta name="twitter:site" content="@willmcginniser">





<link rel="canonical" href="https://elote.mcginniscommawill.com/_modules/elote/arenas/base.html">


 

  </head><body>
<header class="header">
  <div class="header__inner">
    
    <a href="https://mcginniscommawill.com" class="header__logo">
      McGinnis, Will
    </a>

    
    <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
      </svg>
    </button>

    
    <nav class="nav" role="navigation">
      
      
        
          
          
          
          <a href="https://mcginniscommawill.com/guides/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            Guides
          </a>
        
          
          
          
          <a href="https://mcginniscommawill.com/topics/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            Topics
          </a>
        
          
          
          
          <a href="https://mcginniscommawill.com/posts/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            Blog
          </a>
        
          
          
          
          <a href="https://mcginniscommawill.com/about/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            About
          </a>
        
          
          
          
          <a href="https://mcginniscommawill.com/coffee/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            Free Coffee
          </a>
        
          
          
          
          <a href="https://mcginniscommawill.com/oss/" class="nav__link"
             target="_blank" rel="noopener noreferrer">
            OSS
          </a>
        
      

      
      
      <a href="../../../index.html" class="nav__link nav__link--active">
        Docs
      </a>
      
    </nav>
  </div>
</header>


<nav class="breadcrumbs" aria-label="Breadcrumb">
  <div class="breadcrumbs__inner">
    
    <a href="https://mcginniscommawill.com">Home</a>
    <span class="breadcrumbs__separator">/</span>
    
    <a href="../../../index.html">Docs</a>
    
      
      <span class="breadcrumbs__separator">/</span>
      <a href="../../index.html">Module code</a>
      
    
    
    <span class="breadcrumbs__separator">/</span>
    <span>elote.arenas.base</span>
    
  </div>
</nav>

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for elote.arenas.base</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">abc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">elote.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>


<div class="viewcode-block" id="BaseArena">
<a class="viewcode-back" href="../../../api/arenas.html#elote.arenas.base.BaseArena">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BaseArena</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base abstract class for all arena implementations.</span>

<span class="sd">    Arenas manage competitions between multiple competitors, handling matchups,</span>
<span class="sd">    tournaments, and leaderboard generation. This class defines the interface</span>
<span class="sd">    that all arena implementations must follow.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BaseArena.set_competitor_class_var">
<a class="viewcode-back" href="../../../api/arenas.html#elote.arenas.base.BaseArena.set_competitor_class_var">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_competitor_class_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a class variable on all competitors in this arena.</span>

<span class="sd">        This method allows for global configuration of all competitors</span>
<span class="sd">        managed by this arena.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the class variable to set.</span>
<span class="sd">            value: The value to set for the class variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="BaseArena.tournament">
<a class="viewcode-back" href="../../../api/arenas.html#elote.arenas.base.BaseArena.tournament">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tournament</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matchups</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a tournament with the given matchups.</span>

<span class="sd">        A tournament consists of multiple matchups between competitors.</span>

<span class="sd">        Args:</span>
<span class="sd">            matchups (list): A list of matchup pairs to process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="BaseArena.matchup">
<a class="viewcode-back" href="../../../api/arenas.html#elote.arenas.base.BaseArena.matchup">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">matchup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a single matchup between two competitors.</span>

<span class="sd">        Args:</span>
<span class="sd">            a: The first competitor or competitor identifier.</span>
<span class="sd">            b: The second competitor or competitor identifier.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The result of the matchup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="BaseArena.leaderboard">
<a class="viewcode-back" href="../../../api/arenas.html#elote.arenas.base.BaseArena.leaderboard">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">leaderboard</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a leaderboard of all competitors.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A sorted list of competitors and their ratings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="BaseArena.export_state">
<a class="viewcode-back" href="../../../api/arenas.html#elote.arenas.base.BaseArena.export_state">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export the current state of this arena for serialization.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing all necessary information to recreate</span>
<span class="sd">                 this arena&#39;s current state.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>
</div>



<div class="viewcode-block" id="History">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.History">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">History</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tracks the history of bouts (matchups) and provides analysis methods.</span>

<span class="sd">    This class stores the results of matchups and provides methods to analyze</span>
<span class="sd">    the performance of the rating system.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="History.__init__">
<a class="viewcode-back" href="../../../api/arenas.html#elote.arenas.base.History.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize an empty history of bouts.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Bout</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;History initialized.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="History.add_bout">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.History.add_bout">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_bout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bout</span><span class="p">:</span> <span class="s2">&quot;Bout&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a bout to the history.</span>

<span class="sd">        Args:</span>
<span class="sd">            bout (Bout): The bout object to add to the history.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bout</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Added bout between </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">bout</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">bout</span><span class="o">.</span><span class="n">b</span><span class="p">)</span></div>


<div class="viewcode-block" id="History.report_results">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.History.report_results">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">report_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a report of the results in this history.</span>

<span class="sd">        Args:</span>
<span class="sd">            lower_threshold (float): The lower probability threshold for predictions.</span>
<span class="sd">            upper_threshold (float): The upper probability threshold for predictions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of dictionaries containing the results of each bout.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating results report for </span><span class="si">%d</span><span class="s2"> bouts&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">bout</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">:</span>
            <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;predicted_winnder&quot;</span><span class="p">:</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_winner</span><span class="p">(</span><span class="n">lower_threshold</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">),</span>
                    <span class="s2">&quot;predicted_loser&quot;</span><span class="p">:</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_loser</span><span class="p">(</span><span class="n">lower_threshold</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">),</span>
                    <span class="s2">&quot;probability&quot;</span><span class="p">:</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                    <span class="s2">&quot;actual_winner&quot;</span><span class="p">:</span> <span class="n">bout</span><span class="o">.</span><span class="n">actual_winner</span><span class="p">(),</span>
                    <span class="s2">&quot;correct&quot;</span><span class="p">:</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_winner</span><span class="p">(</span><span class="n">lower_threshold</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">)</span> <span class="o">==</span> <span class="n">bout</span><span class="o">.</span><span class="n">actual_winner</span><span class="p">(),</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">report</span></div>


<div class="viewcode-block" id="History.confusion_matrix">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.History.confusion_matrix">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">confusion_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.45</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the confusion matrix for the history of bouts.</span>

<span class="sd">        Args:</span>
<span class="sd">            lower_threshold: The lower threshold for prediction (below this is a prediction for the second competitor)</span>
<span class="sd">            upper_threshold: The upper threshold for prediction (above this is a prediction for the first competitor)</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with confusion matrix metrics: {&#39;tp&#39;: int, &#39;fp&#39;: int, &#39;tn&#39;: int, &#39;fn&#39;: int}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">true_positives</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">false_positives</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">true_negatives</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">false_negatives</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">skipped_bouts</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Calculating confusion matrix for </span><span class="si">%d</span><span class="s2"> bouts with thresholds: [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]&quot;</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">),</span>
            <span class="n">lower_threshold</span><span class="p">,</span>
            <span class="n">upper_threshold</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">bout</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">:</span>
            <span class="c1"># Extract the actual winner and predicted probability</span>
            <span class="n">actual_winner</span> <span class="o">=</span> <span class="n">bout</span><span class="o">.</span><span class="n">actual_winner</span><span class="p">()</span>
            <span class="n">predicted_prob</span> <span class="o">=</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span>

            <span class="c1"># Skip if we don&#39;t have both actual and predicted values</span>
            <span class="k">if</span> <span class="n">actual_winner</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">predicted_prob</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">skipped_bouts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="c1"># Convert predicted_prob to float if it&#39;s a string or None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicted_prob</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">predicted_prob</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">predicted_prob</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="c1"># If conversion fails, skip this bout</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Could not convert predicted_prob &#39;</span><span class="si">%s</span><span class="s2">&#39; to float, skipping bout.&quot;</span><span class="p">,</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span>
                    <span class="p">)</span>
                    <span class="n">skipped_bouts</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">predicted_prob</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">skipped_bouts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="c1"># Determine the predicted outcome</span>
            <span class="k">if</span> <span class="n">predicted_prob</span> <span class="o">&gt;</span> <span class="n">upper_threshold</span><span class="p">:</span>
                <span class="n">predicted_winner</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
            <span class="k">elif</span> <span class="n">predicted_prob</span> <span class="o">&lt;</span> <span class="n">lower_threshold</span><span class="p">:</span>
                <span class="n">predicted_winner</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">predicted_winner</span> <span class="o">=</span> <span class="s2">&quot;draw&quot;</span>

            <span class="c1"># Normalize actual winner to &#39;a&#39;, &#39;b&#39;, or &#39;draw&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actual_winner</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">actual_winner</span> <span class="o">=</span> <span class="n">actual_winner</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">actual_winner</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;win&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">]:</span>
                    <span class="n">actual_winner</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
                <span class="k">elif</span> <span class="n">actual_winner</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">]:</span>
                    <span class="n">actual_winner</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">actual_winner</span> <span class="o">=</span> <span class="s2">&quot;draw&quot;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actual_winner</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">actual_winner</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">actual_winner</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
                <span class="k">elif</span> <span class="n">actual_winner</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">actual_winner</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
                <span class="k">elif</span> <span class="n">actual_winner</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">:</span>
                    <span class="n">actual_winner</span> <span class="o">=</span> <span class="s2">&quot;draw&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Skip if actual winner is not a recognized value</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Unrecognized actual_winner value: </span><span class="si">%s</span><span class="s2">, skipping bout.&quot;</span><span class="p">,</span> <span class="n">bout</span><span class="o">.</span><span class="n">outcome</span><span class="p">)</span>
                    <span class="n">skipped_bouts</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Skip if actual winner is not a recognized type</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Unrecognized actual_winner type: </span><span class="si">%s</span><span class="s2">, skipping bout.&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">bout</span><span class="o">.</span><span class="n">outcome</span><span class="p">))</span>
                <span class="n">skipped_bouts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="c1"># Update confusion matrix</span>
            <span class="k">if</span> <span class="n">predicted_winner</span> <span class="o">==</span> <span class="s2">&quot;draw&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">actual_winner</span> <span class="o">==</span> <span class="s2">&quot;draw&quot;</span><span class="p">:</span>
                    <span class="n">true_positives</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Correctly predicted draw</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">false_positives</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Incorrectly predicted draw</span>
            <span class="k">elif</span> <span class="n">actual_winner</span> <span class="o">==</span> <span class="s2">&quot;draw&quot;</span><span class="p">:</span>
                <span class="n">false_negatives</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Failed to predict draw</span>
            <span class="k">elif</span> <span class="n">predicted_winner</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">actual_winner</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                    <span class="n">true_positives</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">false_positives</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">predicted_winner</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">actual_winner</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
                    <span class="n">true_negatives</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">false_negatives</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">skipped_bouts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipped </span><span class="si">%d</span><span class="s2"> bouts during confusion matrix calculation due to missing data.&quot;</span><span class="p">,</span> <span class="n">skipped_bouts</span><span class="p">)</span>

        <span class="c1"># Return results as a dictionary</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;tp&quot;</span><span class="p">:</span> <span class="n">true_positives</span><span class="p">,</span> <span class="s2">&quot;fp&quot;</span><span class="p">:</span> <span class="n">false_positives</span><span class="p">,</span> <span class="s2">&quot;tn&quot;</span><span class="p">:</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="s2">&quot;fn&quot;</span><span class="p">:</span> <span class="n">false_negatives</span><span class="p">}</span></div>


<div class="viewcode-block" id="History.random_search">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.History.random_search">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">random_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trials</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for optimal prediction thresholds using random sampling.</span>

<span class="sd">        This method performs a random search to find the best lower and upper</span>
<span class="sd">        thresholds that maximize the overall accuracy, including draws.</span>

<span class="sd">        Args:</span>
<span class="sd">            trials (int): The number of random threshold pairs to try.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing (best_accuracy, best_thresholds).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">best_accuracy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">best_thresholds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>  <span class="c1"># Initialize with default values</span>
        <span class="n">num_bouts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing random search for optimal thresholds with </span><span class="si">%d</span><span class="s2"> trials on </span><span class="si">%d</span><span class="s2"> bouts.&quot;</span><span class="p">,</span> <span class="n">trials</span><span class="p">,</span> <span class="n">num_bouts</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_bouts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cannot perform random search on empty history.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">best_accuracy</span><span class="p">,</span> <span class="n">best_thresholds</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
            <span class="c1"># Find min and max predicted outcomes in history</span>
            <span class="n">predicted_outcomes</span> <span class="o">=</span> <span class="p">[</span><span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="k">for</span> <span class="n">bout</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bouts</span> <span class="k">if</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">min_outcome</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">predicted_outcomes</span><span class="p">)</span> <span class="k">if</span> <span class="n">predicted_outcomes</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">max_outcome</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">predicted_outcomes</span><span class="p">)</span> <span class="k">if</span> <span class="n">predicted_outcomes</span> <span class="k">else</span> <span class="mi">1</span>

            <span class="c1"># Generate two random numbers between min and max</span>
            <span class="n">thresholds</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">min_outcome</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_outcome</span> <span class="o">-</span> <span class="n">min_outcome</span><span class="p">),</span>
                    <span class="n">min_outcome</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_outcome</span> <span class="o">-</span> <span class="n">min_outcome</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Calculate metrics with the random thresholds</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics</span><span class="p">(</span><span class="o">*</span><span class="n">thresholds</span><span class="p">)</span>
            <span class="n">accuracy</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">accuracy</span> <span class="o">&gt;</span> <span class="n">best_accuracy</span><span class="p">:</span>
                <span class="n">best_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span>
                <span class="n">best_thresholds</span> <span class="o">=</span> <span class="n">thresholds</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Random search trial </span><span class="si">%d</span><span class="s2">: New best accuracy </span><span class="si">%.4f</span><span class="s2"> with thresholds [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]&quot;</span><span class="p">,</span>
                    <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">best_accuracy</span><span class="p">,</span>
                    <span class="o">*</span><span class="n">best_thresholds</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Random search complete. Best accuracy: </span><span class="si">%.4f</span><span class="s2"> with thresholds [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">best_accuracy</span><span class="p">,</span> <span class="o">*</span><span class="n">best_thresholds</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">best_accuracy</span><span class="p">,</span> <span class="n">best_thresholds</span></div>


<div class="viewcode-block" id="History.optimize_thresholds">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.History.optimize_thresholds">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">optimize_thresholds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span> <span class="n">initial_thresholds</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Optimize prediction thresholds using scipy.optimize.</span>

<span class="sd">        This method uses scipy&#39;s optimization algorithms to find the best thresholds</span>
<span class="sd">        for maximizing prediction accuracy.</span>

<span class="sd">        Args:</span>
<span class="sd">            method (str): The optimization method to use (e.g., &#39;L-BFGS-B&#39;, &#39;Nelder-Mead&#39;)</span>
<span class="sd">            initial_thresholds (tuple): Initial guess for (lower_threshold, upper_threshold)</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: (best_accuracy, best_thresholds) where:</span>
<span class="sd">                - best_accuracy: The accuracy achieved with the optimized thresholds</span>
<span class="sd">                - best_thresholds: List of [lower_threshold, upper_threshold]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">optimize</span>

        <span class="n">num_bouts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Optimizing thresholds using scipy (&#39;</span><span class="si">%s</span><span class="s2">&#39;) on </span><span class="si">%d</span><span class="s2"> bouts.&quot;</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">num_bouts</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_bouts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cannot optimize thresholds on empty history.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">initial_thresholds</span><span class="p">)</span>

        <span class="c1"># Find min and max predicted outcomes in history</span>
        <span class="n">predicted_outcomes</span> <span class="o">=</span> <span class="p">[</span><span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="k">for</span> <span class="n">bout</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bouts</span> <span class="k">if</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">predicted_outcomes</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No valid predicted outcomes found in history. Cannot optimize.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">initial_thresholds</span><span class="p">)</span>
        <span class="n">min_outcome</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">predicted_outcomes</span><span class="p">)</span>
        <span class="n">max_outcome</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">predicted_outcomes</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Predicted outcome range: [</span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span>

        <span class="c1"># Define the objective function to minimize (negative accuracy)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">thresholds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="c1"># Ensure thresholds are sorted</span>
            <span class="n">sorted_thresholds</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics</span><span class="p">(</span><span class="o">*</span><span class="n">sorted_thresholds</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>  <span class="c1"># Negative because we want to maximize accuracy</span>

        <span class="c1"># Calculate baseline accuracy with initial thresholds</span>
        <span class="n">baseline_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics</span><span class="p">(</span><span class="o">*</span><span class="n">initial_thresholds</span><span class="p">)</span>
        <span class="n">baseline_accuracy</span> <span class="o">=</span> <span class="n">baseline_metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Baseline accuracy with initial thresholds [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]: </span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">initial_thresholds</span><span class="p">,</span> <span class="n">baseline_accuracy</span>
        <span class="p">)</span>

        <span class="c1"># Use initial_thresholds as the initial guess</span>
        <span class="n">initial_guess</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">initial_thresholds</span><span class="p">)</span>

        <span class="c1"># Bounds for the thresholds</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">),</span> <span class="p">(</span><span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)]</span>

        <span class="c1"># Run multiple optimizations with different methods and starting points</span>
        <span class="n">best_accuracy</span> <span class="o">=</span> <span class="n">baseline_accuracy</span>
        <span class="n">best_thresholds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">initial_thresholds</span><span class="p">)</span>

        <span class="c1"># Try different optimization methods</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">!=</span> <span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">:</span>
            <span class="n">methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;Nelder-Mead&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Nelder-Mead&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">opt_method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Run the optimization with current method</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Running optimization with method: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">opt_method</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
                    <span class="n">objective</span><span class="p">,</span>
                    <span class="n">initial_guess</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="n">opt_method</span><span class="p">,</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span> <span class="k">if</span> <span class="n">opt_method</span> <span class="o">!=</span> <span class="s2">&quot;Nelder-Mead&quot;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span>
                <span class="p">)</span>

                <span class="c1"># Get the thresholds and ensure they&#39;re sorted</span>
                <span class="n">opt_thresholds</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

                <span class="c1"># Calculate the accuracy</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics</span><span class="p">(</span><span class="o">*</span><span class="n">opt_thresholds</span><span class="p">)</span>
                <span class="n">accuracy</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>

                <span class="c1"># Update best if better than current best</span>
                <span class="k">if</span> <span class="n">accuracy</span> <span class="o">&gt;</span> <span class="n">best_accuracy</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s2">&quot;Optimization (</span><span class="si">%s</span><span class="s2">): New best accuracy </span><span class="si">%.4f</span><span class="s2"> with thresholds [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]&quot;</span><span class="p">,</span>
                        <span class="n">opt_method</span><span class="p">,</span>
                        <span class="n">accuracy</span><span class="p">,</span>
                        <span class="o">*</span><span class="n">opt_thresholds</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">best_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span>
                    <span class="n">best_thresholds</span> <span class="o">=</span> <span class="n">opt_thresholds</span>

                <span class="c1"># Try with a few random starting points</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">random_guess</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">),</span>
                        <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">),</span>
                    <span class="p">]</span>
                    <span class="n">random_guess</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
                        <span class="n">objective</span><span class="p">,</span> <span class="n">random_guess</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">opt_method</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                        <span class="n">opt_thresholds</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics</span><span class="p">(</span><span class="o">*</span><span class="n">opt_thresholds</span><span class="p">)</span>
                        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">accuracy</span> <span class="o">&gt;</span> <span class="n">best_accuracy</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="s2">&quot;Optimization (</span><span class="si">%s</span><span class="s2">, random start </span><span class="si">%d</span><span class="s2">): New best accuracy </span><span class="si">%.4f</span><span class="s2"> with thresholds [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]&quot;</span><span class="p">,</span>
                                <span class="n">opt_method</span><span class="p">,</span>
                                <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">accuracy</span><span class="p">,</span>
                                <span class="o">*</span><span class="n">opt_thresholds</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">best_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span>
                            <span class="n">best_thresholds</span> <span class="o">=</span> <span class="n">opt_thresholds</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Skip if optimization fails</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Optimization with method &#39;</span><span class="si">%s</span><span class="s2">&#39; failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">opt_method</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="c1"># If optimized accuracy is worse than baseline, use baseline</span>
        <span class="k">if</span> <span class="n">best_accuracy</span> <span class="o">&lt;</span> <span class="n">baseline_accuracy</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Optimized accuracy (</span><span class="si">%.4f</span><span class="s2">) is worse than baseline (</span><span class="si">%.4f</span><span class="s2">). Reverting to baseline thresholds.&quot;</span><span class="p">,</span>
                <span class="n">best_accuracy</span><span class="p">,</span>
                <span class="n">baseline_accuracy</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">baseline_accuracy</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">initial_thresholds</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Optimization complete. Best accuracy: </span><span class="si">%.4f</span><span class="s2"> with thresholds [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">best_accuracy</span><span class="p">,</span> <span class="o">*</span><span class="n">best_thresholds</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">best_accuracy</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">best_thresholds</span><span class="p">)</span></div>


<div class="viewcode-block" id="History.calculate_metrics">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.History.calculate_metrics">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate performance metrics based on the confusion matrix.</span>

<span class="sd">        Args:</span>
<span class="sd">            lower_threshold: The lower threshold for prediction (below this is a prediction for the second competitor)</span>
<span class="sd">            upper_threshold: The upper threshold for prediction (above this is a prediction for the first competitor)</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with metrics including accuracy, precision, recall, F1 score, and the confusion matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the confusion matrix</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">lower_threshold</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculated confusion matrix: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cm</span><span class="p">)</span>

        <span class="c1"># Extract values from the confusion matrix</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;fp&quot;</span><span class="p">]</span>
        <span class="n">tn</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;tn&quot;</span><span class="p">]</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;fn&quot;</span><span class="p">]</span>

        <span class="c1"># Calculate total predictions</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">tn</span> <span class="o">+</span> <span class="n">fn</span>

        <span class="c1"># Calculate accuracy</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span> <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Calculate precision</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate recall</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate F1 score</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span> <span class="o">/</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Calculated metrics: Accuracy=</span><span class="si">%.4f</span><span class="s2">, Precision=</span><span class="si">%.4f</span><span class="s2">, Recall=</span><span class="si">%.4f</span><span class="s2">, F1=</span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">f1</span>
        <span class="p">)</span>

        <span class="c1"># Return all metrics</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">,</span> <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span> <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span> <span class="s2">&quot;confusion_matrix&quot;</span><span class="p">:</span> <span class="n">cm</span><span class="p">}</span></div>


<div class="viewcode-block" id="History.calculate_metrics_with_draws">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.History.calculate_metrics_with_draws">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_metrics_with_draws</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">lower_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.33</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.66</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate evaluation metrics for the bout history, treating predictions</span>
<span class="sd">        between thresholds as explicit draw predictions.</span>

<span class="sd">        Args:</span>
<span class="sd">            lower_threshold (float): The lower probability threshold for predictions.</span>
<span class="sd">            upper_threshold (float): The upper probability threshold for predictions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing accuracy, precision, recall, F1 score, and draw metrics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Count the different prediction outcomes</span>
        <span class="n">total_bouts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">correct_predictions</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">true_draw</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">false_draw</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">skipped_bouts</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Calculating metrics with draws for </span><span class="si">%d</span><span class="s2"> bouts using thresholds [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]&quot;</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">),</span>
            <span class="n">lower_threshold</span><span class="p">,</span>
            <span class="n">upper_threshold</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">bout</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">:</span>
            <span class="c1"># Skip if we don&#39;t have both actual and predicted values</span>
            <span class="k">if</span> <span class="n">bout</span><span class="o">.</span><span class="n">actual_winner</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">skipped_bouts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="n">total_bouts</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Determine predicted outcome</span>
            <span class="k">if</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&gt;</span> <span class="n">upper_threshold</span><span class="p">:</span>
                <span class="n">predicted</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
            <span class="k">elif</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&lt;</span> <span class="n">lower_threshold</span><span class="p">:</span>
                <span class="n">predicted</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">predicted</span> <span class="o">=</span> <span class="s2">&quot;draw&quot;</span>

            <span class="c1"># Determine actual outcome</span>
            <span class="n">actual</span> <span class="o">=</span> <span class="n">bout</span><span class="o">.</span><span class="n">actual_winner</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">actual</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">actual</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
                <span class="k">elif</span> <span class="n">actual</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">actual</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
                <span class="k">elif</span> <span class="n">actual</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">:</span>
                    <span class="n">actual</span> <span class="o">=</span> <span class="s2">&quot;draw&quot;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">actual</span> <span class="o">=</span> <span class="n">actual</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">actual</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;win&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">]:</span>
                    <span class="n">actual</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
                <span class="k">elif</span> <span class="n">actual</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">]:</span>
                    <span class="n">actual</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">actual</span> <span class="o">=</span> <span class="s2">&quot;draw&quot;</span>

            <span class="c1"># Count correct predictions</span>
            <span class="k">if</span> <span class="n">predicted</span> <span class="o">==</span> <span class="n">actual</span><span class="p">:</span>
                <span class="n">correct_predictions</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">predicted</span> <span class="o">==</span> <span class="s2">&quot;draw&quot;</span><span class="p">:</span>
                    <span class="n">true_draw</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">predicted</span> <span class="o">==</span> <span class="s2">&quot;draw&quot;</span><span class="p">:</span>
                <span class="n">false_draw</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">total_bouts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No valid bouts found to calculate metrics with draws.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;true_draw&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;false_draw&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;draw_rate&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;draw_accuracy&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;confusion_matrix&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">lower_threshold</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">),</span>
            <span class="p">}</span>

        <span class="c1"># Calculate overall accuracy</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct_predictions</span> <span class="o">/</span> <span class="n">total_bouts</span> <span class="k">if</span> <span class="n">total_bouts</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Get standard metrics from confusion matrix</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">lower_threshold</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">)</span>

        <span class="c1"># Return combined metrics</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">,</span>
            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;fp&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;fp&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;fn&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;fn&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;fp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;fn&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;fp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;fn&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;true_draw&quot;</span><span class="p">:</span> <span class="n">true_draw</span><span class="p">,</span>
            <span class="s2">&quot;false_draw&quot;</span><span class="p">:</span> <span class="n">false_draw</span><span class="p">,</span>
            <span class="s2">&quot;draw_rate&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">true_draw</span> <span class="o">+</span> <span class="n">false_draw</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_bouts</span> <span class="k">if</span> <span class="n">total_bouts</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;draw_accuracy&quot;</span><span class="p">:</span> <span class="n">true_draw</span> <span class="o">/</span> <span class="p">(</span><span class="n">true_draw</span> <span class="o">+</span> <span class="n">false_draw</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">true_draw</span> <span class="o">+</span> <span class="n">false_draw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;confusion_matrix&quot;</span><span class="p">:</span> <span class="n">cm</span><span class="p">,</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="History.accuracy_by_prior_bouts">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.History.accuracy_by_prior_bouts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">accuracy_by_prior_bouts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">arena</span><span class="p">:</span> <span class="s2">&quot;BaseArena&quot;</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate accuracy based on the number of prior bouts for each competitor.</span>

<span class="sd">        This method analyzes how accuracy changes as competitors participate in more bouts,</span>
<span class="sd">        properly accounting for draws as a third outcome category.</span>

<span class="sd">        Args:</span>
<span class="sd">            arena (BaseArena): The arena containing the competitors and their history</span>
<span class="sd">            thresholds (tuple, optional): Tuple of (lower_threshold, upper_threshold) for predictions</span>
<span class="sd">            bin_size (int): Size of bins for grouping bout counts</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary with &#39;binned&#39; key containing binned accuracy data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Default thresholds if not provided</span>
        <span class="k">if</span> <span class="n">thresholds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lower_threshold</span><span class="p">,</span> <span class="n">upper_threshold</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Using default thresholds for accuracy by prior bouts: [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">lower_threshold</span><span class="p">,</span> <span class="n">upper_threshold</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lower_threshold</span><span class="p">,</span> <span class="n">upper_threshold</span> <span class="o">=</span> <span class="n">thresholds</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Using provided thresholds for accuracy by prior bouts: [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">lower_threshold</span><span class="p">,</span> <span class="n">upper_threshold</span>
            <span class="p">)</span>

        <span class="c1"># Track the number of bouts for each competitor</span>
        <span class="n">competitor_bout_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Count all bouts from arena&#39;s history (which includes training data)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arena</span><span class="p">,</span> <span class="s2">&quot;history&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arena</span><span class="o">.</span><span class="n">history</span><span class="p">,</span> <span class="s2">&quot;bouts&quot;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Populating initial bout counts from arena history (</span><span class="si">%d</span><span class="s2"> bouts)&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arena</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">bouts</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">bout</span> <span class="ow">in</span> <span class="n">arena</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">bouts</span><span class="p">:</span>
                <span class="n">competitor_bout_counts</span><span class="p">[</span><span class="n">bout</span><span class="o">.</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">competitor_bout_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bout</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">competitor_bout_counts</span><span class="p">[</span><span class="n">bout</span><span class="o">.</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">competitor_bout_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bout</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Arena history not found or empty. Initial bout counts will be zero.&quot;</span><span class="p">)</span>

        <span class="c1"># Track accuracy by minimum bout count</span>
        <span class="n">accuracy_by_min_bouts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calculating accuracy by prior bouts for </span><span class="si">%d</span><span class="s2"> evaluation bouts.&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">))</span>

        <span class="c1"># Process each bout in the evaluation history</span>
        <span class="k">for</span> <span class="n">bout</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">:</span>
            <span class="c1"># Get the current bout count for each competitor</span>
            <span class="n">a_count</span> <span class="o">=</span> <span class="n">competitor_bout_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bout</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">b_count</span> <span class="o">=</span> <span class="n">competitor_bout_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bout</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Determine the minimum bout count between the two competitors</span>
            <span class="n">min_bout_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a_count</span><span class="p">,</span> <span class="n">b_count</span><span class="p">)</span>

            <span class="c1"># Initialize the bucket if it doesn&#39;t exist</span>
            <span class="k">if</span> <span class="n">min_bout_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">accuracy_by_min_bouts</span><span class="p">:</span>
                <span class="n">accuracy_by_min_bouts</span><span class="p">[</span><span class="n">min_bout_count</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;correct&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

            <span class="c1"># Check if prediction is correct, properly handling draws</span>
            <span class="n">is_predicted_draw</span> <span class="o">=</span> <span class="n">lower_threshold</span> <span class="o">&lt;=</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&lt;=</span> <span class="n">upper_threshold</span>
            <span class="n">is_actual_draw</span> <span class="o">=</span> <span class="n">bout</span><span class="o">.</span><span class="n">outcome</span> <span class="o">==</span> <span class="mf">0.5</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">is_predicted_draw</span> <span class="ow">and</span> <span class="n">is_actual_draw</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&gt;</span> <span class="n">upper_threshold</span> <span class="ow">and</span> <span class="n">bout</span><span class="o">.</span><span class="n">outcome</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&lt;</span> <span class="n">lower_threshold</span> <span class="ow">and</span> <span class="n">bout</span><span class="o">.</span><span class="n">outcome</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">accuracy_by_min_bouts</span><span class="p">[</span><span class="n">min_bout_count</span><span class="p">][</span><span class="s2">&quot;correct&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">accuracy_by_min_bouts</span><span class="p">[</span><span class="n">min_bout_count</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Update bout counts for both competitors for subsequent bouts in evaluation</span>
            <span class="n">competitor_bout_counts</span><span class="p">[</span><span class="n">bout</span><span class="o">.</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">competitor_bout_counts</span><span class="p">[</span><span class="n">bout</span><span class="o">.</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_count</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Calculate accuracy for each bucket</span>
        <span class="k">for</span> <span class="n">_bout_count</span><span class="p">,</span> <span class="n">metrics</span> <span class="ow">in</span> <span class="n">accuracy_by_min_bouts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;correct&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Group data into bins for smoother visualization</span>
        <span class="n">binned_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">metrics</span> <span class="ow">in</span> <span class="n">accuracy_by_min_bouts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">bin_index</span> <span class="o">=</span> <span class="n">count</span> <span class="o">//</span> <span class="n">bin_size</span>
            <span class="k">if</span> <span class="n">bin_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">binned_data</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Creating new bin </span><span class="si">%d</span><span class="s2"> (counts </span><span class="si">%d</span><span class="s2">-</span><span class="si">%d</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="n">bin_index</span><span class="p">,</span>
                    <span class="n">bin_index</span> <span class="o">*</span> <span class="n">bin_size</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">bin_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">bin_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">binned_data</span><span class="p">[</span><span class="n">bin_index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accuracy_sum&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

            <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">binned_data</span><span class="p">[</span><span class="n">bin_index</span><span class="p">][</span><span class="s2">&quot;accuracy_sum&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>
            <span class="n">binned_data</span><span class="p">[</span><span class="n">bin_index</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>

        <span class="c1"># Calculate average accuracy for each bin</span>
        <span class="k">for</span> <span class="n">bin_idx</span><span class="p">,</span> <span class="n">bin_data</span> <span class="ow">in</span> <span class="n">binned_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">bin_data</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">bin_data</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin_data</span><span class="p">[</span><span class="s2">&quot;accuracy_sum&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">bin_data</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">bin_data</span><span class="p">[</span><span class="s2">&quot;accuracy_sum&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bin_data</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">del</span> <span class="n">bin_data</span><span class="p">[</span><span class="s2">&quot;accuracy_sum&quot;</span><span class="p">]</span>

            <span class="c1"># Add bin range information</span>
            <span class="n">bin_data</span><span class="p">[</span><span class="s2">&quot;min_bouts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin_idx</span> <span class="o">*</span> <span class="n">bin_size</span>
            <span class="n">bin_data</span><span class="p">[</span><span class="s2">&quot;max_bouts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">bin_size</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># Return only the binned data in the expected format</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Completed accuracy by prior bouts calculation with bin size </span><span class="si">%d</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;binned&quot;</span><span class="p">:</span> <span class="n">binned_data</span><span class="p">}</span></div>


<div class="viewcode-block" id="History.get_calibration_data">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.History.get_calibration_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_calibration_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute calibration data from the bout history.</span>

<span class="sd">        This method extracts predicted probabilities and actual outcomes from the bout history</span>
<span class="sd">        and prepares them for calibration curve plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">            n_bins (int): Number of bins to use for calibration curve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: (y_true, y_prob) where:</span>
<span class="sd">                - y_true: List of actual outcomes (1.0 for wins, 0.0 for losses)</span>
<span class="sd">                - y_prob: List of predicted probabilities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract predicted probabilities and actual outcomes</span>
        <span class="n">y_prob</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_true</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">skipped_bouts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting calibration data for </span><span class="si">%d</span><span class="s2"> bouts.&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">bout</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bouts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">bout</span><span class="o">.</span><span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">skipped_bouts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="n">y_prob</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bout</span><span class="o">.</span><span class="n">predicted_outcome</span><span class="p">)</span>
            <span class="c1"># Convert outcomes to binary format (1.0 for wins, 0.0 for losses/draws)</span>
            <span class="n">y_true</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="k">if</span> <span class="n">bout</span><span class="o">.</span><span class="n">outcome</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">skipped_bouts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Skipped </span><span class="si">%d</span><span class="s2"> bouts while extracting calibration data due to missing values.&quot;</span><span class="p">,</span> <span class="n">skipped_bouts</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Extracted </span><span class="si">%d</span><span class="s2"> valid data points for calibration.&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_prob</span></div>
</div>



<div class="viewcode-block" id="Bout">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.Bout">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Bout</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A single bout between two competitors.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Bout.__init__">
<a class="viewcode-back" href="../../../api/arenas.html#elote.arenas.base.Bout.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">a</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">b</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">predicted_outcome</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">outcome</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a bout.</span>

<span class="sd">        Args:</span>
<span class="sd">            a: The first competitor</span>
<span class="sd">            b: The second competitor</span>
<span class="sd">            predicted_outcome: The predicted probability of a winning</span>
<span class="sd">            outcome: The actual outcome of the bout</span>
<span class="sd">            attributes: Optional dictionary of additional attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">=</span> <span class="n">predicted_outcome</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">=</span> <span class="n">outcome</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span> <span class="ow">or</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="Bout.actual_winner">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.Bout.actual_winner">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">actual_winner</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the actual winner of the bout based on the outcome.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str or None: &#39;a&#39; if a won, &#39;b&#39; if b won, None if it was a draw or unclear</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">outcome_lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcome</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">outcome_lower</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;win&quot;</span><span class="p">,</span> <span class="s2">&quot;won&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="s2">&quot;a&quot;</span>
            <span class="k">elif</span> <span class="n">outcome_lower</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="s2">&quot;lost&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="s2">&quot;b&quot;</span>
            <span class="k">elif</span> <span class="n">outcome_lower</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;draw&quot;</span><span class="p">,</span> <span class="s2">&quot;tie&quot;</span><span class="p">,</span> <span class="s2">&quot;tied&quot;</span><span class="p">,</span> <span class="s2">&quot;draw&quot;</span><span class="p">,</span> <span class="s2">&quot;0.5&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="s2">&quot;eq&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;a&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;b&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Bout.true_positive">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.Bout.true_positive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">true_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if this bout is a true positive prediction.</span>

<span class="sd">        A true positive occurs when the model correctly predicts a win.</span>

<span class="sd">        Args:</span>
<span class="sd">            threshold (float): The probability threshold for a positive prediction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if this bout is a true positive, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">==</span> <span class="s2">&quot;win&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Bout.false_positive">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.Bout.false_positive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">false_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if this bout is a false positive prediction.</span>

<span class="sd">        A false positive occurs when the model incorrectly predicts a win.</span>

<span class="sd">        Args:</span>
<span class="sd">            threshold (float): The probability threshold for a positive prediction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if this bout is a false positive, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">!=</span> <span class="s2">&quot;win&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Bout.true_negative">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.Bout.true_negative">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">true_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if this bout is a true negative prediction.</span>

<span class="sd">        A true negative occurs when the model correctly predicts a non-win.</span>

<span class="sd">        Args:</span>
<span class="sd">            threshold (float): The probability threshold for a negative prediction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if this bout is a true negative, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">==</span> <span class="s2">&quot;loss&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Bout.false_negative">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.Bout.false_negative">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">false_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if this bout is a false negative prediction.</span>

<span class="sd">        A false negative occurs when the model incorrectly predicts a non-win.</span>

<span class="sd">        Args:</span>
<span class="sd">            threshold (float): The probability threshold for a negative prediction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if this bout is a false negative, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">!=</span> <span class="s2">&quot;loss&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Bout.predicted_winner">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.Bout.predicted_winner">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">predicted_winner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the predicted winner of this bout.</span>

<span class="sd">        Args:</span>
<span class="sd">            lower_threshold (float): The lower probability threshold for predictions.</span>
<span class="sd">            upper_threshold (float): The upper probability threshold for predictions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The identifier of the predicted winner, or None if no winner is predicted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&gt;</span> <span class="n">upper_threshold</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&lt;</span> <span class="n">lower_threshold</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Bout.predicted_loser">
<a class="viewcode-back" href="../../../arenas.html#elote.arenas.base.Bout.predicted_loser">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">predicted_loser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the predicted loser of this bout.</span>

<span class="sd">        Args:</span>
<span class="sd">            lower_threshold (float): The lower probability threshold for predictions.</span>
<span class="sd">            upper_threshold (float): The upper probability threshold for predictions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The identifier of the predicted loser, or None if no loser is predicted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&gt;</span> <span class="n">upper_threshold</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_outcome</span> <span class="o">&lt;</span> <span class="n">lower_threshold</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>
</div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../../index.html">Table of Contents</a></h3>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../competitors.html">Competitors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../arenas.html">Arenas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../serialization.html">Serialization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Rating Systems</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../rating_systems/elo.html">Elo Rating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rating_systems/glicko.html">Glicko Rating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rating_systems/ecf.html">ECF Rating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rating_systems/dwz.html">DWZ Rating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rating_systems/ensemble.html">Ensemble Rating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rating_systems/comparison.html">Comparing Rating Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advance_example.html">Advanced Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../use_cases/product_ranking.html">Product Ranking with Elote</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../use_cases/matchmaking.html">Matchmaking with Elote</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../use_cases/feature_prioritization.html">Feature Prioritization with Elote</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/competitors.html">Competitors API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/arenas.html">Arenas API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../blog_posts.html">Blog Posts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing to Elote</a></li>
</ul>

<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <div class="footer__inner">
    
    
    <div class="footer__links">
      
        <a href="https://github.com/wdm0006" class="footer__link" target="_blank" rel="noopener noreferrer">
          GitHub
        </a>
      
        <a href="https://www.linkedin.com/in/wmcginnis/" class="footer__link" target="_blank" rel="noopener noreferrer">
          LinkedIn
        </a>
      
        <a href="https://x.com/willmcginniser" class="footer__link" target="_blank" rel="noopener noreferrer">
          Twitter
        </a>
      
    </div>
    

    
    <p class="footer__copy">
      
        &copy; 2020, Will McGinnis
      
    </p>
  </div>
</footer>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.querySelector('.nav-toggle');
    const nav = document.querySelector('.nav');
    if (toggle && nav) {
      toggle.addEventListener('click', function() {
        nav.classList.toggle('is-open');
        const isOpen = nav.classList.contains('is-open');
        toggle.setAttribute('aria-expanded', isOpen);
      });
    }
  });
</script>

  </body>
</html>